---
title: "Method"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r prepare, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

library(tidyverse)
library(papaja)
library(gt)
library(knitr)

```

# Method


## Participants


We collected data from `r dat_raw$id_db %>% unique %>% length() %>% printnum()` bilinguals from the Metropolitan Area of Barcelona, between `r min(dat_raw$time_stamp, na.rm = TRUE) %>% format(., "%dth %B, %Y")` and `r max(dat_raw$time_stamp, na.rm = TRUE) %>% format(., "%dth %B, %Y")`. All families participated voluntarily. This study was approved by the Comitè d'Ètica de la Investigació amb Medicaments (CEIm) from Hospital del Mar (Barcelona, Spain), code XXXXXXXXX.


We assessed toddlers' language background asking parents for an estimated proportion of exposure to each language. We defined participants as Spanish- or Catalan-dominant according to the language they were exposed the most to. Participants were considered bilingual - therefore included - if exposed 50-90% of the time to the non-dominant language. We excluded participants with >10% exposure to a third language. Fig. \@ref(fig:lpdist) shows how participants were distributed across age bins and language profiles.


```{r lpdist, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

dat_participants %>%
  filter(lp %in% "Bilingual") %>% 
    mutate(bilingualism = cut_interval(bilingualism, n = 6,
                                       labels = paste0(seq(0, 50, by = 10), "%"))) %>%
    ggplot(aes(x = age_bin, y = bilingualism)) +
    stat_bin_2d(colour = "white") +
  scale_x_discrete(guide = guide_axis(n.dodge = 1)) +
    scale_fill_viridis_c(option = "plasma") +
    labs(x = "Age (months)", y = "L2 exposure", fill = "Participants") +
    theme_classic() +
    theme(axis.text = element_text(colour = "black"))
ggsave(here("Figures", "participants.png"), height = 4, width = 5)
```


## Questionnaire


Parents completed an on-line questionnaire that gathered information about their demographic status, language environment of the child, and that included two vocabulary inventories: one for Catalan and one for Spanish. We implemented the questionnaire in `formr` [@arslan2020], a free, open-source platform. Participants were randomly allocated into one of four list of items. Each list contained a distinct inventory of translation equivalents. We included items from a diverse sample of `r distinct(dat_items, category) %>% nrow()` semantic/functional categories:  Action words, adventures, animals, body parts, clothes, colour, descriptive words, food and drink, furniture and rooms, household items, on-line, outside, parts of animals, parts of things, people, pronouns, quantifiers, question words, time, toys, and vehicles. We discarded the following categories: adverbs, auxiliary words, connectives, interjections and games and routines. Those categories that did not entail more than 16 items - thus resulting in less than four items after dividing it in four lists - were not divided: all of their items were included in the four lists. Another subset of items that were part of the trial lists of some experiments in the lab were also included in all versions.

Each item of the inventory presented a word-form, to which parents were instructed to report whether the toddlers was able to understand it, understand ans say it, or neither. The Catalan inventory contained `r filter(dat_items, language=="Catalan") %>% pull(item) %>% unique() %>% length()` items (`r filter(dat_items, cognate_rater1, language=="Catalan") %>% pull(item) %>% unique() %>% length()` cognates, `r filter(dat_items, !cognate_rater1, language=="Catalan") %>% pull(item) %>% unique() %>% length()` non-cognates) and the Spanish inventory contained `r filter(dat_items, language=="Spanish") %>% pull(item) %>% unique() %>% length()` (`r filter(dat_items, cognate_rater1, language=="Spanish") %>% pull(item) %>% unique() %>% length()` cognates, `r filter(dat_items, !cognate_rater1, language=="Spanish") %>% pull(item) %>% unique() %>% length()` non-cognates) . Items of one language were translation equivalents from the other (e.g., whenever *gos* [dog] was included in the Catalan inventory, the word *perro* was included in the Spanish inventory), roughly following a one-to-one mapping. When there were two acceptable translation equivalents for a given word, we included both (e.g., Catalan *acabar* [*to finish*] and Spanish *acabar* and *terminar*), or merged them into the same one (e.g., Spanish *mono* [*monkey*] and Catalan *mono/mico*). We excluded from the analysis multi-word items (e.g., *barrita de cereales* [cereal bar]) and items that included more than one word-form (e.g., *mono / mico*).


## Data analysis


For testing Hypothesis 1, we modelled the proportion of infants that understood or produced each item in the non-dominant language within age bins of 2 months. Our model assumes that this proportion follows a logistic curve across ages, an that the age of acquisition of each item is generated from a linear model that adjusts for the degree of exposure to the non-dominant language (*bilingualism*, 0-50%), the cognate status of the word (*cognateness*, Non-cognate vs. Cognate), and their interaction. Our prediction is that the age of acquisition will be lower for cognate words, compared to that of non-cognate words, and that this effect will be larger for more balanced bilinguals.


Items were classified into cognates and non-cognates by a trained Catalan-Spanish bilingual with broad experience in phonology and phonetics. Items were classified as L1 if the item was included in the inventory of the language the participant was dominant in, and as L2 if otherwise For instance, the item *porta* (*door*, in Catalan) was classified as L1 when answered by Catalan-dominant participants, and as L2 when answered by Spanish-dominant participants. Table \@ref(tab:itemsinfo) shows the classification of items in cognates and non-cognates and their frequency scores across the four lists of the inventories.


```{r itemsinfo, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

dat_items %>%
    drop_na(cognate_rater1) %>%
    filter(include) %>%
    select(A, B, C, D, cognate_rater1, frequency, language) %>% 
    mutate(cognate_rater1 = ifelse(cognate_rater1, "Cognate", "Non-cognate")) %>%
    pivot_longer(c(A, B, C, D), names_to = c("list"), values_to = "n") %>% 
    filter(n) %>% 
    group_by(list, language, cognate_rater1) %>% 
    summarise(n = sum(n, na.rm = TRUE),
              mean = mean(frequency, na.rm = TRUE),
              sd = sd(frequency, na.rm = TRUE),
              min = min(frequency, na.rm = TRUE),
              max = max(frequency, na.rm = TRUE),
              .groups = "drop") %>%
    ungroup() %>% 
    rename(cognateness = cognate_rater1) %>%
    relocate(list, language, cognateness, n, mean, sd, min, max) %>%
    arrange(list, language, cognateness) %>%
    mutate(list = paste("List", list)) %>% 
    pivot_wider(names_from = cognateness, values_from = c(n, mean, sd, min, max)) %>%
    clean_names() %>%
    gt(groupname_col = c("language")) %>% 
    fmt_number(columns = contains("cognate"), decimals = 2) %>%
    fmt_number(columns = starts_with("n_"), decimals = 0) %>%
    tab_header(title = md("**Questionnaire and item properties**"),
               subtitle = "Participants were randomly allocated on of the the four lists, and completed both the Catalan and the Spanish versions.") %>% 
    tab_spanner(label = "Frequency (Cognates)", columns = vars("n_cognate", "mean_cognate", "sd_cognate", "min_cognate", "max_cognate")) %>% 
    tab_spanner(label = "Frequency (Non-cognates)", columns = contains("non_cognate")) %>% 
    cols_label(list = md("**List**"), 
               n_cognate = md("*N*"),
               mean_cognate = md("*Mean*"),
               sd_cognate = md("*SD*"),
               min_cognate = md("*Min*"),
               max_cognate = md("*Max*"),
               n_non_cognate = md("*N*"),
               mean_non_cognate = md("*Mean*"),
               sd_non_cognate = md("*SD*"),
               min_non_cognate = md("*Min*"),
               max_non_cognate = md("*Max*")) 

```


We fit two separate logistic models on comprehensive and productive data, respectively. Logistic curves are characterised by three parameters[see @mahr2019 and @mahr2020 for an excellent introduction to this approach, in which we based this analysis]: (a) an *asymptote* (`asym`, upper boundary  of the proportion of infants that have acquired the item), (b) the *steepness* (`steep`, how fast the a given item is acquired by infants), and (c) a *mid-point* (`mid`, the age at which steepness is maximum). We work on the assumption that the trajectory of acquisition of items follows a logistic curve shape [@mayor2011], and that the age of acquisition of a word is fairly captured by the position of the mid-point of its curve. This approach allows us to model and estimate the age of acquisition of items explicitly. Our model estimated the asymptote and steepness as grand means across items (i.e., intercepts). Mid-points were estimated by a linear regression model that included our predictors of interest: `age`, `item_dominance` (sum-coded, L2 = -0.5, L1 = 0.5), `cognateness` (sum-coded, Non-cognate = -0.5, Cognate = 0.5). We also included random intercepts and `item dominance` slopes for each translation equivalent (`te`) [@barr2013]. Appendix 1 shows a detailed description of the model.


We estimated the parameters of our model using the Bayesian framework. Bayesian models use the Bayes rule to combine prior knowledge about the distribution of a given parameter, and the likelihood of each of the values it can take given the data. We relied on the available data on Wordbank [@frank2017] to generate our prior (see Appendix 1 for more details about our prior). In order to test the contribution of each predictor on the fit of the model, we started fitting a null model that only included an global intercept and random intercepts for each TE, then fitted a model that also included *bilingualism* and its random slopes by TE, and finally a model that also included *cognateness* and its interaction with *bilingualism*, as well as random slopes for all the fixed effects. We compared how the fit of the model changed in every step [@schad2020] using leave-one-out cross validation. We fit both the null and alternative models using the R environment [@rcoreteam2013; @rstudioteam2015] and the `brms` package [@burkner2017], which relies on the probabilistic language Stan [@carpenter2017] to approximate posterior distributions. We used Pareto-smoothed importance sampling [PSIS; @vehtari2017; @vehtari2019] to compare the null and extended models. Data and model results were processed and visualised using the `tidyverse` family of R packages [@wickham2019] and the `tidybayes` package [@kay2020].


To test Hypothesis 2, we run a Bayesian ANOVA using the difference in mid-points between the two word-forms of each translation equivalent (in Catalan and Spanish, respectively), that included *cognateness* as predictor. Using the `BayesFactor` R package [@morey2018a], we computed a Bayes factor (*BF*) that compared the likelihood of a linear model that included *cognateness* as a predictor against the likelihood of a linear model that did not, under the light of our data.
